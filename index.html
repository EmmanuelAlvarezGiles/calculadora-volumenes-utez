<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarea Integradora UTEZ | C√°lculo Vectorial 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        /* --- VARIABLES --- */
        :root {
            --utez-green: #00965e;
            --utez-dark: #004d33;
            --utez-gold: #eeb310;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --container-3d-bg: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
            transition: background 0.3s, color 0.3s;
        }

        /* --- HEADER ESTILO IMAGEN 5 --- */
        header {
            background-color: var(--header-bg);
            width: 100%;
            border-top: 10px solid var(--utez-green);
            border-bottom: 5px solid var(--utez-green);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            padding: 20px 40px;
            box-sizing: border-box;
            text-align: center;
            position: relative;
        }

        .header-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .logo-utez {
            height: 70px;
            display: block;
        }

        /* Bot√≥n Modo Halc√≥n discreto */
        .toggle-mode {
            background: var(--utez-green);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: background 0.3s;
        }
        .toggle-mode:hover { background: var(--utez-dark); }

        .header-content h1 {
            color: var(--utez-dark);
            font-size: 2.2rem;
            margin: 0;
            font-weight: 800;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #555;
            margin: 10px 0;
            font-weight: 500;
        }

        .profesor {
            color: var(--utez-green);
            font-weight: bold;
            margin: 5px 0;
        }

        .integrantes {
            margin-top: 15px;
            font-size: 0.95rem;
            color: #666;
            font-style: italic;
            border-top: 1px solid #eee;
            padding-top: 10px;
            display: inline-block;
        }

        /* --- MEN√ö DE FIGURAS --- */
        .menu-container {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 50px auto;
            max-width: 1200px;
            flex-wrap: wrap;
            perspective: 1000px;
            padding: 0 20px;
        }

        .shape-card {
            width: 150px;
            height: 170px;
            background: var(--card-bg);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
            transition: transform 0.4s, box-shadow 0.4s;
            border-bottom: 4px solid var(--utez-green);
            text-align: center;
            padding: 10px;
        }

        .shape-card:hover {
            transform: translateY(-12px) rotateX(5deg);
            box-shadow: 0 20px 30px rgba(0,150,94,0.2);
            border-bottom-color: var(--utez-gold);
        }

        .shape-img {
            height: 80px;
            width: auto;
            margin-bottom: 10px;
            object-fit: contain;
        }

        .shape-card span {
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--utez-dark);
        }

        /* --- √ÅREA DE C√ÅLCULO Y 3D --- */
        #calculation-area {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px; /* Un poco m√°s ancho para el 3D */
            text-align: center;
            display: none;
            border: 1px solid #eee;
            border-top: 5px solid var(--utez-green);
            margin-bottom: 50px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* NUEVO: Contenedor para la escena 3D */
        #container-3d {
            width: 100%;
            height: 350px;
            background-color: var(--container-3d-bg);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid var(--utez-green);
            position: relative;
        }
        /* Etiqueta para los ejes 3D */
        .axis-label {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.8rem;
            color: #555;
            background: rgba(255,255,255,0.7);
            padding: 2px 5px;
            border-radius: 4px;
            pointer-events: none;
        }

        .input-group { margin: 15px 0; text-align: left; }
        
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 600; 
            color: var(--utez-dark); 
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            background: #fafafa;
        }

        input:focus {
            border-color: var(--utez-green);
            outline: none;
            background: #fff;
        }

        .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button.action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .btn-calc { background-color: var(--utez-dark); color: white; }
        .btn-clear { background-color: #e74c3c; color: white; }
        
        button.action-btn:hover { opacity: 0.9; }

        #result {
            margin-top: 25px;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--utez-green);
            padding: 10px;
            background: rgba(0,150,94,0.1);
            border-radius: 8px;
        }

        /* --- MODO OSCURO --- */
        body.dark-mode {
            --bg-color: #121212;
            --text-color: #f0f0f0;
            --card-bg: #1e1e1e;
            --header-bg: #1a1a1a;
            --container-3d-bg: #333;
        }
        
        body.dark-mode .header-content h1 { color: #fff; }
        body.dark-mode .subtitle { color: #ccc; }
        body.dark-mode .integrantes { color: #aaa; border-top-color: #333; }
        body.dark-mode .header-top-bar { border-bottom-color: #333; }
        body.dark-mode input { background: #333; border-color: #444; color: white; }
        body.dark-mode label { color: var(--utez-gold); }
        body.dark-mode .shape-card span { color: #fff; }

    </style>
</head>
<body>

    <header>
        <div class="header-top-bar">
            <img src="img/logo-utez.png" alt="Logo UTEZ" class="logo-utez">
            <button class="toggle-mode" onclick="toggleTheme()">üåô Modo Halc√≥n</button>
        </div>
        
        <div class="header-content">
            <h1>Tarea Integradora C√°lculo de Varias Variables</h1>
            <p class="subtitle">Prop√≥sito: C√°lculo de Vol√∫menes y Modelado 3D</p>
            <p class="profesor">Profesor: Luis Ramirez</p>
            
            <div class="integrantes">
                Integrantes: | Rodrigo Arvizu | Jose Manuel Martinez | Uriel Solano | Emmanuel Alvarez | Eliel Vasquez |
            </div>
        </div>
    </header>

    <main class="menu-container">
        <div class="shape-card" onclick="selectShape('elipsoide')">
            <img src="img/elipsoide.jpg" alt="Elipsoide" class="shape-img">
            <span>Elipsoide</span>
        </div>
        <div class="shape-card" onclick="selectShape('conoEliptico')">
            <img src="img/cono.jpg" alt="Cono El√≠ptico" class="shape-img">
            <span>Cono El√≠ptico</span>
        </div>
        <div class="shape-card" onclick="selectShape('hiper2hojas')">
            <img src="img/hiper2.jpg" alt="Hiperboloide de dos hojas" class="shape-img">
            <span>Hiperboloide (2 hojas)</span>
        </div>
        <div class="shape-card" onclick="selectShape('hiper1hoja')">
            <img src="img/hiper1.jpg" alt="Hiperboloide de una hoja" class="shape-img">
            <span>Hiperboloide (1 hoja)</span>
        </div>
        <div class="shape-card" onclick="selectShape('paraboloide')">
            <img src="img/paraboloide.jpg" alt="Paraboloide El√≠ptico" class="shape-img">
            <span>Paraboloide El√≠ptico</span>
        </div>
    </main>

    <section id="calculation-area">
        <h2 id="shape-title" style="margin-top:0; color:var(--utez-green)">Selecciona Figura</h2>
        
        <div id="container-3d">
            <div class="axis-label">Rojo: X | Verde: Y | Azul: Z</div>
        </div>

        <div id="inputs-container"></div>
        
        <div class="btn-row">
            <button class="action-btn btn-calc" onclick="calculateAndRender()">Calcular y Modelar 3D</button>
            <button class="action-btn btn-clear" onclick="clearInputs()">Borrar</button>
        </div>
        
        <div id="result"></div>
    </section>

    <script>
        let currentShape = '';
        // Variables globales para Three.js
        let scene, camera, renderer, currentMesh, axesHelper;

        // Definici√≥n de las figuras e inputs
        const shapes = {
            elipsoide: {
                title: "Elipsoide",
                inputs: [{id: "a", label: "Semieje a (X)"}, {id: "b", label: "Semieje b (Y)"}, {id: "c", label: "Semieje c (Z)"}]
            },
            conoEliptico: {
                title: "Cono El√≠ptico",
                inputs: [{id: "a", label: "Semieje a (X)"}, {id: "b", label: "Semieje b (Y)"}, {id: "h", label: "Altura h (Z)"}]
            },
            paraboloide: {
                title: "Paraboloide El√≠ptico",
                inputs: [{id: "a", label: "Semieje a (X)"}, {id: "b", label: "Semieje b (Y)"}, {id: "h", label: "Altura h (Z)"}]
            },
            hiper1hoja: {
                title: "Hiperboloide (1 Hoja)",
                note: "Visualizaci√≥n entre z = -h y z = +h",
                inputs: [{id: "a", label: "Valor a (X)"}, {id: "b", label: "Valor b (Y)"}, {id: "c", label: "Valor c (Z)"}, {id: "h", label: "Mitad de Altura h"}]
            },
            hiper2hojas: {
                title: "Hiperboloide (2 Hojas)",
                note: "Visualizaci√≥n de segmentos superior e inferior",
                inputs: [{id: "a", label: "Valor a (X)"}, {id: "b", label: "Valor b (Y)"}, {id: "c", label: "Valor c (Z)"}, {id: "h", label: "Altura h del segmento"}]
            }
        };

        // --- INICIALIZACI√ìN DE THREE.JS ---
        function init3D() {
            const container = document.getElementById('container-3d');
            // Si ya existe, no reiniciamos
            if (container.getElementsByTagName('canvas').length > 0) return;

            scene = new THREE.Scene();
            // C√°mara: Campo de visi√≥n, aspecto, plano cercano, plano lejano
            camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            // Posici√≥n inicial de la c√°mara
            camera.position.set(15, 15, 15);
            camera.lookAt(0, 0, 0);

            // Iluminaci√≥n b√°sica
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 10);
            scene.add(directionalLight);

            // Ejes de referencia (Rojo=X, Verde=Y, Azul=Z)
            axesHelper = new THREE.AxesHelper(10);
            scene.add(axesHelper);

            animate();
        }

        // Bucle de animaci√≥n para que el objeto rote
        function animate() {
            requestAnimationFrame(animate);
            if (currentMesh) {
                currentMesh.rotation.y += 0.005; // Rotaci√≥n suave
            }
            renderer.render(scene, camera);
        }

        // --- FUNCIONES DE LA L√ìGICA DE LA P√ÅGINA ---

        function selectShape(key) {
            currentShape = key;
            const data = shapes[key];
            const area = document.getElementById('calculation-area');
            const container = document.getElementById('inputs-container');
            const resultDiv = document.getElementById('result');

            area.style.display = 'block';
            document.getElementById('shape-title').innerText = data.title;
            resultDiv.style.display = 'none';
            container.innerHTML = '';

            if(data.note) {
                const note = document.createElement('p');
                note.style.fontSize = "0.8rem"; note.style.color = "#666"; note.innerText = data.note;
                container.appendChild(note);
            }

            data.inputs.forEach(input => {
                const div = document.createElement('div');
                div.className = 'input-group';
                div.innerHTML = `<label>${input.label}:</label><input type="number" id="${input.id}" step="any" placeholder="Valor > 0">`;
                container.appendChild(div);
            });

            area.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Inicializar el entorno 3D si no se ha hecho
            init3D();
            // Limpiar figura anterior si existe
            if (currentMesh) { scene.remove(currentMesh); currentMesh = null; }
        }

        // --- FUNCI√ìN PRINCIPAL: CALCULAR Y MODELAR ---
        function calculateAndRender() {
            // 1. Validar Inputs
            const inputs = document.querySelectorAll('#inputs-container input');
            let valid = true;
            const params = {};
            inputs.forEach(i => {
                const val = parseFloat(i.value);
                if (isNaN(val) || val <= 0) valid = false;
                params[i.id] = val;
            });

            const resDiv = document.getElementById('result');
            resDiv.style.display = 'block';

            if (!valid) {
                resDiv.innerText = "Por favor ingresa valores positivos v√°lidos en todos los campos.";
                resDiv.style.color = "red"; resDiv.style.background = "#ffe6e6";
                if (currentMesh) { scene.remove(currentMesh); currentMesh = null; }
                return;
            }

            // 2. Calcular Volumen (L√≥gica anterior)
            let v = 0; const pi = Math.PI;
            const { a, b, c, h } = params;

            if (currentShape === 'elipsoide') v = (4/3) * pi * a * b * c;
            else if (currentShape === 'conoEliptico') v = (1/3) * pi * a * b * h;
            else if (currentShape === 'paraboloide') v = (0.5) * pi * a * b * h;
            else if (currentShape === 'hiper1hoja') v = 2 * pi * a * b * (h + (Math.pow(h,3) / (3 * Math.pow(c,2))));
            else if (currentShape === 'hiper2hojas') v = 2 * (pi * a * b * ( (Math.pow(h,3)/(3*Math.pow(c,2))) + (Math.pow(h,2)/c) )); // Multiplicado por 2 para ambas hojas

            resDiv.innerHTML = `Volumen Total ‚âà ${v.toFixed(4)} u¬≥`;
            resDiv.style.color = "var(--utez-dark)"; resDiv.style.background = "rgba(0,150,94,0.1)";

            // 3. Generar Modelo 3D
            update3DModel(currentShape, params);
        }

        // --- GENERACI√ìN DE GEOMETR√çAS 3D ---
        function update3DModel(shape, params) {
            if (currentMesh) scene.remove(currentMesh);
            const { a, b, c, h } = params;
            
            // Materiales: S√≥lido para figuras cerradas, Wireframe para abiertas
            const materialSolid = new THREE.MeshPhongMaterial({ 
                color: 0x00965e, transparent: true, opacity: 0.8, shininess: 100 
            });
            const materialWireframe = new THREE.LineBasicMaterial({ color: 0x004d33 });

            switch (shape) {
                case 'elipsoide':
                    // Esfera escalada en X, Y, Z
                    const sphereGeo = new THREE.SphereGeometry(1, 32, 32);
                    currentMesh = new THREE.Mesh(sphereGeo, materialSolid);
                    currentMesh.scale.set(a, b, c);
                    break;

                case 'conoEliptico':
                    // Cono escalado en X, Y. Altura h.
                    const coneGeo = new THREE.ConeGeometry(1, h, 32);
                    currentMesh = new THREE.Mesh(coneGeo, materialSolid);
                    currentMesh.scale.set(a, b, 1); // Escalar radio base X e Y
                    // Mover el cono hacia arriba para que la base est√© en z=0 (Threejs centra el cono)
                    currentMesh.position.y = h / 2; 
                    // Rotar para que apunte hacia Z (opcional, depende de tu preferencia de ejes)
                    currentMesh.rotation.x = Math.PI / 2;
                    break;

                // --- FIGURAS COMPLEJAS (Estilo Wireframe Matem√°tico) ---
                case 'paraboloide':
                case 'hiper1hoja':
                case 'hiper2hojas':
                    currentMesh = generateComplexShape(shape, a, b, c, h, materialWireframe);
                    break;
            }

            if (currentMesh) scene.add(currentMesh);
        }

        // Funci√≥n auxiliar para generar las figuras "dif√≠ciles" usando l√≠neas
        function generateComplexShape(type, a, b, c, h, material) {
            const points = [];
            const segments = 20; // Resoluci√≥n vertical
            const radialSegments = 32; // Resoluci√≥n angular

            for (let i = 0; i <= segments; i++) {
                // Calcular la altura z actual seg√∫n el tipo de figura
                let z;
                if (type === 'paraboloide') z = (i / segments) * h; // z va de 0 a h
                else if (type === 'hiper1hoja') z = (i / segments) * 2 * h - h; // z va de -h a h
                else if (type === 'hiper2hojas') {
                     // Hacemos la hoja superior. z va de c a c+h
                     z = c + (i / segments) * h; 
                }

                // Calcular el radio efectivo en esta altura z basado en la f√≥rmula
                let radiusScale = 0;
                if (type === 'paraboloide') radiusScale = Math.sqrt(z / c) || 0; // Asumiendo c=1 para la forma est√°ndar z = x¬≤/a¬≤ + y¬≤/b¬≤
                else if (type === 'hiper1hoja') radiusScale = Math.sqrt(1 + (z*z)/(c*c)); // x¬≤/a¬≤ + y¬≤/b¬≤ - z¬≤/c¬≤ = 1
                else if (type === 'hiper2hojas') radiusScale = Math.sqrt((z*z)/(c*c) - 1); // z¬≤/c¬≤ - x¬≤/a¬≤ - y¬≤/b¬≤ = 1

                // Generar el anillo el√≠ptico a esta altura
                for (let j = 0; j <= radialSegments; j++) {
                    const theta = (j / radialSegments) * Math.PI * 2;
                    const x = a * radiusScale * Math.cos(theta);
                    const y = b * radiusScale * Math.sin(theta);
                    points.push(new THREE.Vector3(x, y, z));
                    // Para hiperboloide de 2 hojas, a√±adir la hoja inferior sim√©trica
                    if(type === 'hiper2hojas') points.push(new THREE.Vector3(x, y, -z)); 
                }
            }
            
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            // Usamos LineSegments para un look de "anillos" apilados
            return new THREE.LineSegments(geometry, material);
        }


        function clearInputs() {
            document.querySelectorAll('#inputs-container input').forEach(i => i.value = '');
            document.getElementById('result').style.display = 'none';
            if (currentMesh) { scene.remove(currentMesh); currentMesh = null; }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.toggle-mode');
            btn.innerText = document.body.classList.contains('dark-mode') ? "‚òÄÔ∏è Modo D√≠a" : "üåô Modo Halc√≥n";
            // Ajustar color del fondo 3D en modo oscuro
             if(renderer) renderer.setClearColor(document.body.classList.contains('dark-mode') ? 0x333333 : 0xe0e0e0);
        }

        // Ajustar el tama√±o del renderizador si cambia el tama√±o de la ventana
        window.addEventListener('resize', () => {
            if(camera && renderer) {
                const container = document.getElementById('container-3d');
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        });
    </script>
</body>
</html>